# Chapter 2: Mathematical Foundations

## Learning Objectives

By the end of this chapter, you will be able to:

1. Define lattices in three-dimensional space and understand their mathematical properties
2. Characterize the Body-Centered Cubic (BCC) lattice using the parity constraint
3. Derive the Voronoi cell structure (truncated octahedron) of BCC lattice points
4. Calculate neighbor connectivity and prove the 14-neighbor property
5. Understand hierarchical refinement and parent-child relationships
6. Apply sampling theory to explain BCC optimality
7. Measure geometric isotropy quantitatively

If Chapter 1 was about *why* cubic grids struggle in practice, this chapter is about *what to use instead* and *how it works under the hood*.
We will alternate between:

- **Formal statements** (definitions, theorems, proofs) that make the geometry precise, and
- **Intuitive explanations** that connect those statements to mental pictures and implementation details.

You do not need to memorize the proofs. Treat them as guarantees that the geometric tricks you’ll use later are built on solid ground.

---

## 2.1 Lattices in Three-Dimensional Space

### 2.1.1 Definition of a Lattice

A **lattice** $\mathcal{L}$ in $\mathbb{R}^3$ is a discrete subgroup of the additive group $(\mathbb{R}^3, +)$ that can be generated by integer linear combinations of three linearly independent basis vectors.

**Definition 2.1** (Lattice): Given three linearly independent vectors $\mathbf{v}_1, \mathbf{v}_2, \mathbf{v}_3 \in \mathbb{R}^3$, the lattice $\mathcal{L}$ generated by these basis vectors is:

$$
\mathcal{L} = \\{ n_1 \mathbf{v}_1 + n_2 \mathbf{v}_2 + n_3 \mathbf{v}_3 : n_1, n_2, n_3 \in \mathbb{Z} \\}
$$

Informally, you can think of a lattice as:

- Pick three directions in space (the basis vectors).
- Allow integer steps forward or backward along each direction.
- Mark every point you can reach that way.

The resulting infinite, regularly repeating point set is your lattice.

**Example 2.1** (Simple Cubic Lattice): The standard basis vectors $\mathbf{e}_1 = (1,0,0)$, $\mathbf{e}_2 = (0,1,0)$, $\mathbf{e}_3 = (0,0,1)$ generate the simple cubic (SC) lattice:

$$
\mathcal{L}_{SC} = \\{ (n_1, n_2, n_3) : n_1, n_2, n_3 \in \mathbb{Z} \\} = \mathbb{Z}^3
$$

This is the familiar integer grid in three dimensions.

Concretely:

- $(0,0,0)$ is the origin.
- $(1,0,0)$, $(0,1,0)$, and $(0,0,1)$ are one step along the $x$, $y$, and $z$ axes.
- Any integer triple $(n_1,n_2,n_3)$ is some number of steps along each axis.

### 2.1.2 Fundamental Domain

The **fundamental domain** (or primitive cell) of a lattice is the minimal region that, when translated by all lattice vectors, tiles the entire space without gaps or overlaps.

For the simple cubic lattice, the fundamental domain is the unit cube $[0,1)^3$ with volume 1.

**Definition 2.2** (Unit Cell Volume): The volume of the fundamental domain is the absolute value of the determinant of the matrix formed by the basis vectors:

$$
V = |\det(\mathbf{v}_1, \mathbf{v}_2, \mathbf{v}_3)|
$$

This volume represents the "density" of the lattice—how many lattice points per unit volume.

An easy way to build intuition—

- In 1D, if points are spaced $h$ units apart, each point “owns” an interval of length $h$.
- In 2D, if points lie on a square grid with spacing $h$, each point “owns” a square of area $h^2$.
- In 3D, the fundamental domain plays the same role: it is the **volume of space per lattice point**.

Different choices of basis vectors may describe the same geometric lattice; their fundamental domains can look different but always tile space without gaps or overlaps.

### 2.1.3 Common 3D Lattices

Three important lattice types appear in crystallography and physics:

**Simple Cubic (SC)**
- Basis vectors: $(1,0,0)$, $(0,1,0)$, $(0,0,1)$
- Coordination number: 6 nearest neighbors
- Unit cell volume: 1
- Examples: Polonium ($\alpha$-Po)

**Face-Centered Cubic (FCC)**
- Basis vectors: $(0, \frac{1}{2}, \frac{1}{2})$, $(\frac{1}{2}, 0, \frac{1}{2})$, $(\frac{1}{2}, \frac{1}{2}, 0)$
- Coordination number: 12 nearest neighbors
- Unit cell volume: $\frac{1}{4}$ (4 points per conventional cubic cell)
- Examples: Copper (Cu), Aluminum (Al), Gold (Au)

**Body-Centered Cubic (BCC)**
- Basis vectors: $(-\frac{1}{2}, \frac{1}{2}, \frac{1}{2})$, $(\frac{1}{2}, -\frac{1}{2}, \frac{1}{2})$, $(\frac{1}{2}, \frac{1}{2}, -\frac{1}{2})$
- Coordination number: 8 nearest neighbors (+ 6 next-nearest)
- Unit cell volume: $\frac{1}{2}$ (2 points per conventional cubic cell)
- Examples: Iron (Fe), Chromium (Cr), Tungsten (W)

For computational purposes, we'll work with an equivalent integer representation of BCC.

You can picture these three lattices as:

- **SC**: One point at each cube corner.
- **FCC**: SC plus a point at the center of each cube face.
- **BCC**: SC plus a single point at the center of each cube.

At a distance, all three look like “cubes everywhere,” but the internal arrangement of points inside each cube is different. That hidden structure is what drives differences in isotropy and sampling efficiency.

---

## 2.2 The Body-Centered Cubic Lattice

### 2.2.1 Integer Representation

For implementation in software, we use an integer coordinate representation of the BCC lattice:

**Definition 2.3** (BCC Lattice, Integer Form): The Body-Centered Cubic lattice in integer coordinates is:

$$
\mathcal{L}_{BCC} = \\{ (x, y, z) \in \mathbb{Z}^3 : (x + y + z) \equiv 0 \pmod{2} \\}
$$

This is the set of all integer points where the coordinate sum is even.

You can check membership with a mental parity test:

- $(0,0,0)$: $0 + 0 + 0 = 0$ (even) → in BCC
- $(1,0,0)$: $1 + 0 + 0 = 1$ (odd) → not in BCC
- $(1,1,0)$: $1 + 1 + 0 = 2$ (even) → in BCC
- $(2,1,1)$: $2 + 1 + 1 = 4$ (even) → in BCC
- $(2,0,1)$: $2 + 0 + 1 = 3$ (odd) → not in BCC

In code, this often becomes a simple `(x + y + z) & 1 == 0` check.

**Lemma 2.1** (Parity Constraint): A point $(x, y, z)$ is in $\mathcal{L}_{BCC}$ if and only if:
$$
(x \bmod 2) + (y \bmod 2) + (z \bmod 2) \in \\{0, 2\\}
$$

Equivalently, either all three coordinates are even, or exactly one is even and two are odd.

### 2.2.2 Two Interpenetrating Sublattices

The BCC lattice can be viewed as the union of two sublattices:

**Even Sublattice** $\mathcal{L}_e$:
$$
\mathcal{L}_e = \\{ (x, y, z) : x, y, z \text{ all even} \\} = (2\mathbb{Z})^3
$$

**Odd Sublattice** $\mathcal{L}_o$:
$$
\mathcal{L}_o = \\{ (x, y, z) : x, y, z \text{ all odd} \\}
$$

Then $\mathcal{L}_{BCC} = \mathcal{L}_e \cup \mathcal{L}_o$, and these sets are disjoint: $\mathcal{L}_e \cap \mathcal{L}_o = \emptyset$.

**Geometric Interpretation**: $\mathcal{L}_e$ forms a cubic grid with spacing 2. $\mathcal{L}_o$ is the same cubic grid shifted by $(1, 1, 1)$. The "body-centered" name comes from the fact that odd points sit at the centers of the cubes formed by even points.

Another way to visualize this:

- Draw a coarse $2 \times 2 \times 2$ block of even points at coordinates like $(0,0,0)$, $(2,0,0)$, …, $(2,2,2)$.
- Place a point at the center of that block, at $(1,1,1)$.
- Repeat this pattern in all directions.

From far away, the even and odd sublattices interleave into a very uniform cloud of points, but up close the alternating structure is clear.

### 2.2.3 Density and Efficiency

**Proposition 2.1** (BCC Density): The BCC lattice contains exactly half of the points of the integer cubic lattice $\mathbb{Z}^3$.

*Proof*: For any integer $(x, y, z)$, the sum $x + y + z$ is either even or odd with equal probability. The parity constraint $(x + y + z) \equiv 0 \pmod{2}$ selects exactly half of all integer points. $\square$

**Corollary 2.1**: In a volume of $N^3$, the simple cubic lattice has $\approx N^3$ points, while the BCC lattice has $\approx \frac{N^3}{2}$ points.

However, this 50% reduction comes with better geometric properties, as we'll see.

For example, over a $256 \times 256 \times 256$ region:

- A simple cubic grid stores about $16.8$ million samples.
- A BCC lattice covering the same region stores about half as many samples, yet still supports faithful reconstruction of bandlimited signals.

This “do more with fewer points” property is a central reason to care about BCC.

### 2.2.4 Closure Under Addition and Subtraction

**Theorem 2.1** (BCC Group Structure): $\mathcal{L}_{BCC}$ is closed under vector addition and subtraction.

*Proof*: Let $(x_1, y_1, z_1), (x_2, y_2, z_2) \in \mathcal{L}_{BCC}$. Then:
$$
(x_1 + y_1 + z_1) \equiv 0 \pmod{2}
$$
$$
(x_2 + y_2 + z_2) \equiv 0 \pmod{2}
$$

Adding:
$$
(x_1 + x_2) + (y_1 + y_2) + (z_1 + z_2) \equiv 0 + 0 = 0 \pmod{2}
$$

So $(x_1 + x_2, y_1 + y_2, z_1 + z_2) \in \mathcal{L}_{BCC}$. The proof for subtraction is identical. $\square$

This means that offsets between BCC points are themselves BCC vectors, which is crucial for neighbor calculations.

---

## 2.3 Voronoi Cells and Truncated Octahedra

### 2.3.1 Voronoi Diagrams

**Definition 2.4** (Voronoi Cell): For a point $\mathbf{p}$ in a lattice $\mathcal{L}$, the Voronoi cell $V(\mathbf{p})$ is the set of all points in $\mathbb{R}^3$ that are closer to $\mathbf{p}$ than to any other lattice point:

$$
V(\mathbf{p}) = \\{ \mathbf{x} \in \mathbb{R}^3 : |\mathbf{x} - \mathbf{p}| \leq |\mathbf{x} - \mathbf{q}| \text{ for all } \mathbf{q} \in \mathcal{L} \\}
$$

The Voronoi cell is the region of space "owned" by a lattice point. Voronoi cells partition space—every point in $\mathbb{R}^3$ belongs to exactly one cell (with boundaries shared between cells).

In 2D, this picture is familiar:

- For a square grid, each point owns a square.
- For a hexagonal grid, each point owns a regular hexagon.

We are now doing the same construction in 3D. The **shape** of the Voronoi cell tells you what a “locally fair” neighborhood looks like around each lattice point.

**For a simple cubic lattice**, the Voronoi cell is a **cube** with side length 1 (assuming unit lattice spacing).

**For the BCC lattice**, the Voronoi cell is a **truncated octahedron**.

### 2.3.2 The Truncated Octahedron

A **truncated octahedron** is a convex polyhedron with:
- **14 faces**: 6 squares and 8 regular hexagons
- **24 vertices**
- **36 edges**: all of equal length

**Theorem 2.2** (BCC Voronoi Cell): The Voronoi cell of a point in $\mathcal{L}_{BCC}$ is a truncated octahedron.

*Proof Sketch*:
1. Consider the origin $(0, 0, 0)$ (which is in $\mathcal{L}_{BCC}$)
2. Find all nearest neighbors (we'll show there are 14 in Section 2.5)
3. The perpendicular bisector planes to these neighbors form the Voronoi cell boundaries
4. The intersection of these 14 half-spaces produces a truncated octahedron

We defer the detailed calculation to Section 2.5 after establishing neighbor connectivity. $\square$

### 2.3.3 Properties of the Truncated Octahedron

**Volume**: For unit lattice spacing, the truncated octahedron has volume $V = 8\sqrt{2}$.

**Space-Filling**: Truncated octahedra tile 3D space perfectly with no gaps or overlaps. This is called a **honeycomb** or **tessellation**.

**Symmetry**: The truncated octahedron has **point group symmetry** $O_h$ (octahedral symmetry with inversion), the same as a cube.

**Near-Spherical**: Among space-filling polyhedra, the truncated octahedron is one of the most sphere-like. Its **isoperimetric quotient** (ratio of volume to surface area, normalized) is 0.910, compared to 1.000 for a sphere and 0.806 for a cube.

This near-spherical property is key to isotropy.

### 2.3.4 Visualization

Imagine the truncated octahedron as:
1. Start with a **regular octahedron** (8 triangular faces)
2. **Truncate** (cut off) all 6 vertices at the midpoint of the edges meeting there
3. The 8 triangular faces become 8 hexagons
4. The 6 truncation cuts create 6 square faces

The result is a polyhedron that "looks" approximately spherical from a distance but packs perfectly to fill space.

If you took horizontal slices through a truncated octahedron, the cross-sections would smoothly morph between hexagons and squares as you move up and down. This “rounded cube” behavior is why BCC neighborhoods feel much closer to spheres than the boxy neighborhoods of a simple cubic grid.

---

## 2.4 Geometric Properties and Isotropy

### 2.4.1 Isotropy Defined

**Definition 2.5** (Isotropy): A geometric structure is **isotropic** if its properties are the same in all directions. Quantitatively, we can measure isotropy by the **coefficient of variation** (CV) of directional measurements:

$$
\text{CV} = \frac{\sigma}{\mu}
$$

where $\sigma$ is the standard deviation and $\mu$ is the mean.

In plain language:

- $\mu$ is the **typical neighbor distance**.
- $\sigma$ measures how much those distances **vary** as you look in different directions.
- CV is a unitless “unevenness score” for those distances.

For a perfectly isotropic structure, CV = 0 (all directions identical). Higher CV indicates greater anisotropy.

### 2.4.2 Neighbor Distance Analysis

For the **simple cubic lattice** with 26-neighbor connectivity:
- 6 face neighbors at distance $d = 1$
- 12 edge neighbors at distance $d = \sqrt{2} \approx 1.414$
- 8 vertex neighbors at distance $d = \sqrt{3} \approx 1.732$

**Mean distance**:
$$
\mu_{cubic} = \frac{6 \cdot 1 + 12 \cdot \sqrt{2} + 8 \cdot \sqrt{3}}{26} \approx 1.415
$$

**Standard deviation**: $\sigma_{cubic} \approx 0.298$

**Coefficient of variation**:
$$
\text{CV}_{cubic} = \frac{0.298}{1.415} \approx 0.211
$$

For the **BCC lattice** with 14-neighbor connectivity:
- 8 opposite-parity neighbors at distance $d = \sqrt{3} \approx 1.732$
- 6 same-parity neighbors at distance $d = 2$

**Mean distance**:
$$
\mu_{BCC} = \frac{8 \cdot \sqrt{3} + 6 \cdot 2}{14} \approx 1.846
$$

**Standard deviation**: $\sigma_{BCC} \approx 0.134$

**Coefficient of variation**:
$$
\text{CV}_{BCC} = \frac{0.134}{1.846} \approx 0.073
$$

**Result**: BCC has **3× lower variation** in neighbor distances than cubic grids, indicating much better isotropy.

You do not need to memorize these particular numbers. What matters is the qualitative picture:

- Cubic grids have three distinct neighbor distance scales ($1$, $\sqrt{2}$, $\sqrt{3}$) that are relatively far apart.
- BCC has only two scales ($\sqrt{3}$ and $2$) that are closer together.

The smaller spread of neighbor distances is precisely what the low CV is measuring, and it is what gives BCC its more direction-agnostic behavior.

### 2.4.3 Quantitative Isotropy Theorem

**Theorem 2.3** (BCC Isotropy): The Body-Centered Cubic lattice has a neighbor distance coefficient of variation of approximately 0.073, compared to 0.211 for face-edge-vertex connectivity in simple cubic lattices.

*Proof*: By explicit calculation above. $\square$

This 3× improvement in isotropy is one of the key advantages of BCC lattices.

### 2.4.4 Implications for Algorithms

**Pathfinding**: With lower CV, path lengths are less sensitive to direction. Empirically, BCC pathfinding achieves ±5% error relative to Euclidean distance, vs. ±41% for cubic grids.

**Interpolation**: Isotropic neighbor distances mean interpolation weights are more uniform, reducing directional artifacts in reconstructed fields.

**Distance Metrics**: Approximations to Euclidean distance (like Manhattan or Chebyshev distance) are more accurate on BCC lattices.

---

## 2.5 Neighbor Connectivity

### 2.5.1 Definition of Neighbors

**Definition 2.6** (k-Neighbors): Two lattice points $\mathbf{p}, \mathbf{q} \in \mathcal{L}$ are **k-neighbors** if their Euclidean distance is the k-th smallest distance from $\mathbf{p}$ to any other lattice point.

For BCC lattices:
- **First neighbors** (nearest): 8 points at distance $\sqrt{3}$
- **Second neighbors** (next-nearest): 6 points at distance $2$

In this book, "14-neighbor connectivity" means using both first and second neighbors.

Any time you see “expand to all 14 neighbors” in later algorithms, it refers to this exact stencil of 8 opposite-parity and 6 same-parity neighbors.

### 2.5.2 Opposite-Parity Neighbors

**Theorem 2.4** (Opposite-Parity Nearest Neighbors): For any point $(x, y, z) \in \mathcal{L}_{BCC}$, the 8 nearest neighbors are the opposite-parity points:

$$
(x \pm 1, y \pm 1, z \pm 1)
$$

where the signs are chosen independently, giving $2^3 = 8$ neighbors.

*Proof*:
1. Let $(x, y, z) \in \mathcal{L}_{BCC}$ have even parity: $x + y + z \equiv 0 \pmod{2}$
2. For $(x \pm 1, y \pm 1, z \pm 1)$, the coordinate sum is:
   $$
   (x \pm 1) + (y \pm 1) + (z \pm 1) = (x + y + z) \pm 3 \equiv 0 \pm 1 = 1 \pmod{2}
   $$
   So these points have odd parity and are in $\mathcal{L}_{BCC}$.
3. The distance is:
   $$
   \sqrt{(\pm 1)^2 + (\pm 1)^2 + (\pm 1)^2} = \sqrt{3} \approx 1.732
   $$
4. Any closer lattice point would need to differ by at most 1 in each coordinate and have distance $< \sqrt{3}$. By exhaustive enumeration, no such point exists that also satisfies the parity constraint.
$\square$

### 2.5.3 Same-Parity Next-Nearest Neighbors

**Theorem 2.5** (Same-Parity Second Neighbors): For any point $(x, y, z) \in \mathcal{L}_{BCC}$, the 6 next-nearest neighbors are the same-parity points:

$$
(x \pm 2, y, z), \quad (x, y \pm 2, z), \quad (x, y, z \pm 2)
$$

*Proof*:
1. For $(x \pm 2, y, z)$, the coordinate sum is:
   $$
   (x \pm 2) + y + z = (x + y + z) \pm 2 \equiv 0 \pmod{2}
   $$
   So same parity, in $\mathcal{L}_{BCC}$.
2. Distance:
   $$
   \sqrt{(\pm 2)^2 + 0^2 + 0^2} = 2
   $$
3. These are the next-nearest after the 8 opposite-parity neighbors at distance $\sqrt{3} \approx 1.732$.
$\square$

### 2.5.4 Complete Neighbor Specification

**Definition 2.7** (14-Neighbor Offsets): For a point $(x, y, z)$ in $\mathcal{L}_{BCC}$, the 14 neighbors are:

**Opposite-Parity (8)**: Distance $\sqrt{3}$
$$
\\{(x + \delta_x, y + \delta_y, z + \delta_z) : \delta_x, \delta_y, \delta_z \in \\{-1, +1\\}\\}
$$

**Same-Parity (6)**: Distance $2$
$$
\\{(x \pm 2, y, z), (x, y \pm 2, z), (x, y, z \pm 2)\\}
$$

These 14 neighbors define the **connectivity graph** of the BCC lattice.

### 2.5.5 Neighbor Lookup Implementation

In code (Rust):

```rust
pub const BCC_NEIGHBORS_14: [(i32, i32, i32); 14] = [
    // Opposite-parity (distance √3 ≈ 1.732)
    (1, 1, 1), (-1, -1, -1), (1, -1, -1), (-1, 1, 1),
    (1, 1, -1), (-1, -1, 1), (1, -1, 1), (-1, 1, -1),

    // Same-parity (distance 2.0)
    (2, 0, 0), (-2, 0, 0),
    (0, 2, 0), (0, -2, 0),
    (0, 0, 2), (0, 0, -2),
];

pub fn neighbors_route64(cell: Route64) -> Vec<Route64> {
    let (x, y, z) = (cell.x(), cell.y(), cell.z());

    BCC_NEIGHBORS_14.iter()
        .filter_map(|&(dx, dy, dz)| {
            let nx = x + dx;
            let ny = y + dy;
            let nz = z + dz;

            // Parity check (should always pass for BCC neighbors)
            if (nx + ny + nz) & 1 == (x + y + z) & 1 {
                Route64::new(0, nx, ny, nz).ok()
            } else {
                None
            }
        })
        .collect()
}
```

The parity check in the filter is defensive—for properly constructed BCC neighbors, it should never fail.

Reading this top-to-bottom:

- `BCC_NEIGHBORS_14` encodes the mathematical offsets defined earlier in this section.
- `neighbors_route64` adds each offset to the current cell’s coordinates.
- The parity test is a safety net that rejects any offset that would leave the BCC lattice.
- `Route64::new` converts the raw coordinates into the Morton-encoded index used throughout the rest of the system.

---

## 2.6 Hierarchical Refinement

### 2.6.1 Level of Detail (LOD) Concept

Many applications require representing data at multiple resolutions:
- **Coarse** levels for distant or low-importance regions
- **Fine** levels for nearby or high-importance regions

The BCC lattice supports clean hierarchical refinement.

You can think of LOD levels as zoom levels in a map:

- At a coarse zoom, one cell might summarize an entire neighborhood.
- At a fine zoom, individual buildings or even rooms might each occupy their own cells.

Our goal is to move between these zoom levels while preserving the BCC structure and its parity properties.

### 2.6.2 Parent-Child Relationship

**Definition 2.8** (Parent Cell): For a cell at LOD $l$ with coordinates $(x, y, z)$, the parent at LOD $l-1$ is:

$$
\text{parent}(x, y, z) = \left( \left\lfloor \frac{x}{2} \right\rfloor, \left\lfloor \frac{y}{2} \right\rfloor, \left\lfloor \frac{z}{2} \right\rfloor \right)
$$

**Definition 2.9** (Child Cells): For a cell at LOD $l$ with coordinates $(x_p, y_p, z_p)$, the 8 children at LOD $l+1$ are:

$$
(2x_p + \delta_x, 2y_p + \delta_y, 2z_p + \delta_z)
$$

where $\delta_x, \delta_y, \delta_z \in \\{0, 1\\}$ and $\delta_x + \delta_y + \delta_z \equiv (x_p + y_p + z_p) \pmod{2}$ (parity preservation).

As a concrete example, suppose $(x_p, y_p, z_p) = (3, 1, 2)$:

- The parent sum is $3 + 1 + 2 = 6$ (even), so it lies on the BCC lattice.
- Children live at coordinates $(6 + \delta_x, 2 + \delta_y, 4 + \delta_z)$.
- Only those $(\delta_x, \delta_y, \delta_z)$ with even sum (0 or 2) preserve parity and are valid BCC children.

This gives exactly 8 children arranged in a local BCC pattern around the parent.

### 2.6.3 Parity Preservation

**Theorem 2.6** (Hierarchical Parity Preservation): If $(x_p, y_p, z_p) \in \mathcal{L}_{BCC}$, then all 8 children computed via the above formula are also in $\mathcal{L}_{BCC}$.

*Proof*:
1. Assume $(x_p + y_p + z_p) \equiv 0 \pmod{2}$ (parent has even parity)
2. A child coordinate sum is:
   $$
   (2x_p + \delta_x) + (2y_p + \delta_y) + (2z_p + \delta_z) = 2(x_p + y_p + z_p) + (\delta_x + \delta_y + \delta_z)
   $$
3. Since $2(x_p + y_p + z_p) \equiv 0 \pmod{2}$ (even number times anything is even), the parity is determined by $\delta_x + \delta_y + \delta_z$.
4. By construction, we choose $\delta_x + \delta_y + \delta_z \equiv 0 \pmod{2}$ (matching parent parity).
5. Therefore, child sum $\equiv 0 + 0 = 0 \pmod{2}$, so child $\in \mathcal{L}_{BCC}$.
$\square$

### 2.6.4 Eight-to-One Refinement

**Corollary 2.2**: Each BCC lattice cell has exactly 8 children, and 8 children have exactly 1 parent.

This 8:1 ratio is the same as cubic octrees, making BCC hierarchies intuitive and efficient.

### 2.6.5 Morton Code Encoding of Hierarchy

Using Morton encoding (interleaving coordinate bits), the parent-child relationship becomes:

**Parent**: Right-shift Morton code by 3 bits (divide by 8)
**Children**: Left-shift Morton code by 3 bits, then add 0-7

This allows $O(1)$ hierarchical navigation in a Morton-encoded index.

---

## 2.7 Sampling Theory and Nyquist Rate

### 2.7.1 Bandlimited Signals

In signal processing, a function $f: \mathbb{R}^3 \to \mathbb{R}$ is **bandlimited** if its Fourier transform has compact support:

$$
\hat{f}(\omega) = 0 \text{ for } |\omega| > \omega_{max}
$$

Intuitively, a bandlimited function has no "infinitely sharp" features—it's smooth at some scale.

In 1D audio terms:

- A pure sine wave at 440 Hz, or a chord containing a few harmonics up to 5 kHz, is effectively bandlimited.
- An ideal click (Dirac impulse) is not bandlimited; it needs infinitely many frequencies.

Here we are applying the same idea to functions over 3D space instead of time.

### 2.7.2 Nyquist-Shannon Theorem in 3D

**Theorem 2.7** (Nyquist-Shannon, 3D): A bandlimited function $f: \mathbb{R}^3 \to \mathbb{R}$ with spherical bandwidth $\omega_{max}$ can be perfectly reconstructed from samples on a lattice $\mathcal{L}$ if the sampling density is at least:

$$
\rho \geq \frac{\omega_{max}^3}{6\pi^2}
$$

The **minimum lattice density** to achieve this sampling rate determines which lattice is most efficient.

In 1D, Nyquist is often summarized as “sample at least twice the highest frequency.”  
In 3D, we instead talk about placing lattice points so that their **copies in frequency space** (the reciprocal lattice) do not overlap when convolved with the spherical bandwidth of the signal.

### 2.7.3 Petersen-Middleton Theorem

**Theorem 2.8** (Petersen & Middleton, 1962): For spherically bandlimited signals in $\mathbb{R}^3$, the Body-Centered Cubic lattice achieves the minimum sampling density required for perfect reconstruction.

Specifically, the BCC lattice requires **29% fewer samples** than a simple cubic lattice for the same bandwidth.

*Proof Sketch*:
1. The Fourier transform of a lattice is the **reciprocal lattice**
2. For perfect reconstruction, the reciprocal lattice must "cover" the Fourier domain without aliasing
3. The reciprocal lattice of BCC is FCC (face-centered cubic)
4. The FCC lattice has optimal covering properties for spherical regions in frequency space
5. Calculating the number of lattice points in a sphere shows BCC requires $\frac{1}{1.29} \approx 0.775$ times as many points as SC

For the full proof, see Petersen & Middleton (1962) or Appendix A.1. $\square$

A useful way to remember this result:

- In the **spatial domain**, BCC looks like a slightly exotic but regular point pattern.
- In the **frequency domain**, its reciprocal lattice (FCC) is exceptionally good at packing spheres without overlap.

That optimal packing is exactly what sampling theory demands when the signal’s bandwidth is spherically bounded.

### 2.7.4 Practical Implications

For volumetric data (medical scans, climate models, etc.), using BCC sampling:
- **Save 29% memory** for the same resolution
- **Or increase resolution by 38%** for the same memory budget (since $(1/0.71)^{1/3} \approx 1.38$)

This is a fundamental advantage from geometry, not an engineering trick.

---

## 2.8 Summary

This chapter established the rigorous mathematical foundation for BCC lattices:

**Lattice Definition**: $\mathcal{L}_{BCC} = \\{(x,y,z) \in \mathbb{Z}^3 : (x+y+z) \equiv 0 \pmod{2}\\}$

**Voronoi Cell**: Truncated octahedron with 14 faces

**Neighbor Connectivity**: Exactly 14 neighbors (8 at distance $\sqrt{3}$, 6 at distance $2$)

**Isotropy**: Coefficient of variation 0.073 (vs. 0.211 for cubic grids)

**Hierarchical Structure**: Clean 8:1 parent-child refinement with parity preservation

**Sampling Optimality**: 29% fewer samples than cubic grids for bandlimited signals (Petersen-Middleton theorem)

These properties make BCC lattices geometrically optimal for 3D spatial indexing. In the next chapter, we explore data structures that exploit this optimality.

---

## Key Concepts

- **Lattice**: Discrete additive subgroup of $\mathbb{R}^3$
- **Parity Constraint**: $(x + y + z) \equiv 0 \pmod{2}$ defines BCC
- **Voronoi Cell**: Region closer to a lattice point than any other
- **Truncated Octahedron**: 14-faced Voronoi cell of BCC
- **Isotropy**: Uniformity across directions (measured by CV)
- **14-Neighbor Connectivity**: 8 opposite-parity + 6 same-parity
- **Hierarchical Refinement**: 8:1 parent-child relationship
- **Nyquist-Shannon Theorem**: Minimum sampling density for reconstruction
- **Petersen-Middleton Theorem**: BCC is optimal for 3D sampling

---

## Exercises

### Basic Understanding

**2.1**: Verify that the points $(0,0,0)$, $(2,2,0)$, $(1,1,1)$, and $(3,2,1)$ are all in $\mathcal{L}_{BCC}$.

**2.2**: For the point $(4, 6, 8)$, list all 14 neighbors. Verify the parity constraint for each.

**2.3**: Calculate the mean and standard deviation of neighbor distances for BCC (8 at $\sqrt{3}$, 6 at $2$). Verify CV = 0.073.

### Intermediate

**2.4**: Prove that the parity of a BCC point determines whether it belongs to the even or odd sublattice. Give the characteristic function for each.

**2.5**: For a point $(x, y, z)$ at LOD 5, compute its parent at LOD 4 and verify the parent is also in $\mathcal{L}_{BCC}$.

**2.6**: Write pseudocode to generate all 8 children of a BCC point, ensuring parity preservation.

**2.7**: The truncated octahedron has 14 faces. Calculate the solid angle subtended by each face from the cell center. Are they equal?

### Advanced

**2.8**: Prove Theorem 2.1 (closure under addition) rigorously for the odd sublattice.

**2.9**: Calculate the volume of a truncated octahedron with edge length $a$. Show that it equals $8\sqrt{2} a^3$.

**2.10**: The isoperimetric quotient is $Q = \frac{V^2}{S^3} \cdot (36\pi)$, where $V$ is volume and $S$ is surface area. Calculate $Q$ for the truncated octahedron.

**2.11**: Implement a function to test if a set of points forms a valid BCC sublattice (all same parity, correct spacing).

### Research

**2.12**: Read Petersen & Middleton (1962). Summarize the proof that BCC is optimal for spherically bandlimited signals. What assumptions are required?

**2.13**: The Face-Centered Cubic (FCC) lattice is the reciprocal lattice of BCC. Prove this relationship and explain its significance for Fourier sampling.

**2.14**: Investigate the truncated octahedron as a "permutahedron." What combinatorial optimization problems have solutions related to this geometry?

**2.15**: Compare BCC with the Hexagonal Close-Packed (HCP) structure. Both have 12 nearest neighbors in the crystallographic sense. Why does BCC have only 8 nearest neighbors in our integer coordinate system?

---

## Further Reading

### Foundational Papers

- **Petersen, D. P., & Middleton, D.** (1962). "Sampling and reconstruction of wave-number-limited functions in N-dimensional Euclidean spaces." *Information and Control*, 5(4), 279-323.
  - The definitive proof of BCC optimality

- **Condat, L., & Van De Ville, D.** (2006). "Three-directional box-splines: Characterization and efficient evaluation." *IEEE Signal Processing Letters*, 13(7), 417-420.
  - BCC wavelets and reconstruction

### Crystallography

- **Ashcroft, N. W., & Mermin, N. D.** (1976). *Solid State Physics*. Holt, Rinehart and Winston. Chapter 4: Crystal Structures.
  - Comprehensive treatment of BCC and other lattices

- **Kittel, C.** (2005). *Introduction to Solid State Physics*, 8th ed. Wiley.
  - Accessible introduction to crystal structures

### Computational Geometry

- **Okabe, A., Boots, B., Sugihara, K., & Chiu, S. N.** (2000). *Spatial Tessellations: Concepts and Applications of Voronoi Diagrams*, 2nd ed. Wiley.
  - Voronoi diagrams and Delaunay triangulation

- **Conway, J. H., & Sloane, N. J. A.** (1999). *Sphere Packings, Lattices and Groups*, 3rd ed. Springer.
  - Mathematical theory of lattices

### Volume Rendering

- **Entezari, A., Möller, T., & Zwicker, M.** (2006). "Practical box splines for reconstruction on the body centered cubic lattice." *IEEE Transactions on Visualization and Computer Graphics*, 12(3), 313-320.
  - BCC lattices for volume rendering

- **Csébfalvi, B., & Hadwiger, M.** (2006). "Prefiltered B-spline reconstruction for hardware-accelerated rendering of optimally sampled volumetric data." *Proceedings of Vision, Modeling, and Visualization*.
  - GPU-accelerated BCC rendering

### Signal Processing

- **Mersereau, R. M.** (1979). "The processing of hexagonally sampled two-dimensional signals." *Proceedings of the IEEE*, 67(6), 930-949.
  - 2D hexagonal sampling (analogous principles to 3D BCC)

- **Dubois, E.** (1985). "The sampling and reconstruction of time-varying imagery with application in video systems." *Proceedings of the IEEE*, 73(4), 502-522.
  - Sampling theory foundations

---

*"In mathematics, elegance is not a dispensable luxury but a quality that decides between success and failure."*
— Edsger W. Dijkstra

*"The BCC lattice: nature's elegant solution to 3D space-filling."*
— Chapter 2 Summary
